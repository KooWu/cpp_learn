#!/bin/bash

echo "$0 file is running"

echo "BUILD_MODULE_DIR: ${BUILD_MODULE_DIR}"
echo "BUILD_TYPE: ${BUILD_TYPE}"
echo "BUILD_INSTALL_DIR: ${BUILD_INSTALL_DIR}"
echo "PLATFORM_TYPE: ${PLATFORM_TYPE}"
    

#编译
if [ "${IS_FORCE}" = "True" -o ! -e ${BUILD_MODULE_DIR}/${PLATFORM_TYPE}_build ];then
    rm -rf ${BUILD_MODULE_DIR}/${PLATFORM_TYPE}_build
    cmake -S ${BUILD_MODULE_DIR}/ \
    -DCMAKE_BUILD_TYPE=${BUILD_TYPE} \
    -DCMAKE_MODULE_PATH=${BUILD_DEPEND_DIR} \
    -DCMAKE_PREFIX_PATH=${BUILD_DEPEND_DIR} \
    -DCMAKE_TOOLCHAIN_FILE=${BUILD_TOOLCHAIN_FILE} \
    -DCMAKE_INSTALL_PREFIX=${BUILD_INSTALL_DIR} \
    -DBUILD_SHARED_LIBS=ON \
    -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
    -B ${BUILD_MODULE_DIR}/${PLATFORM_TYPE}_build
fi
#build & install
cmake --build ${BUILD_MODULE_DIR}/${PLATFORM_TYPE}_build --target ${TARGET_NAME} -j ${CORE_NUM}