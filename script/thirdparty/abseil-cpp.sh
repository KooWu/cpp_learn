#!/bin/bash

echo "$0 file is running"

#编译
if [ ${CVI_CLEAN_REBUILD} -eq 1 -o ! -e ${CVI_BUILD_MODULE}/${CVI_BUILD_PLATFORM}_build ];then
    rm -rf ${CVI_BUILD_MODULE}/${CVI_BUILD_PLATFORM}_build
    cmake -S ${CVI_BUILD_MODULE} \
    -DCMAKE_BUILD_TYPE=${CVI_BUILD_TYPE} \
    -DCMAKE_MODULE_PATH=${CVI_INSTALL_PREFIX} \
    -DCMAKE_PREFIX_PATH=${CVI_INSTALL_PREFIX} \
    -DCMAKE_TOOLCHAIN_FILE=${CVI_BUILD_TOOLCHAIN} \
    -DCMAKE_INSTALL_PREFIX=${CVI_INSTALL_PREFIX} \
    -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \
    -DBUILD_SHARED_LIBS=ON \
    -B ${CVI_BUILD_MODULE}/${CVI_BUILD_PLATFORM}_build
fi
#build & install
cmake --build ${CVI_BUILD_MODULE}/${CVI_BUILD_PLATFORM}_build --target ${CVI_BUILD_TARGET} -j "$(nproc)"